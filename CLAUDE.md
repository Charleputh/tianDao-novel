# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 项目概述

这是一个基于HTML/JavaScript的在线小说阅读器项目，支持动态章节管理和自动部署到GitHub Pages。主要特点包括响应式设计、自动章节扫描、热更新和GitHub Actions自动部署。

## 常用命令

### 章节管理
```bash
# 添加新章节（推荐方式）
./add_chapter.sh <章节号> <章节标题>
# 示例: ./add_chapter.sh 16 "新的征程"

# 更新章节列表
./update_chapters.sh

# 重新生成章节JSON文件
python3 generate_chapters.py
```

### 部署相关
```bash
# 快速部署到GitHub Pages
./deploy.sh

# 带自定义提交信息的部署
./deploy.sh "添加第16章内容"

# 手动Git操作
git add .
git commit -m "更新内容"
git push
```

### 本地开发
```bash
# 启动本地服务器
python3 -m http.server 8000

# 访问地址
http://localhost:8000/index.html
```

## 项目架构

### 核心文件结构
- `index.html` - 主要的阅读器界面，包含响应式设计和章节导航
- `chapters/` - 存放所有章节Markdown文件的目录
- `chapters.json` - 自动生成的章节列表配置文件
- `generate_chapters.py` - 章节扫描和JSON生成脚本

### 自动化脚本
- `add_chapter.sh` - 创建新章节文件和模板的便捷脚本
- `update_chapters.sh` - 更新章节列表并可选自动部署
- `deploy.sh` - Git提交和推送的自动部署脚本

### 部署配置
- `.github/workflows/deploy.yml` - GitHub Actions自动部署配置
- 支持推送到main分支后自动部署到GitHub Pages

## 章节文件规范

### 命名格式
章节文件必须遵循格式：`第X章_章节标题.md`
- 支持中文数字：第一章、第二章...第十章、第十一章等
- 也支持阿拉伯数字：第1章、第2章等

### 文件模板
新章节文件会自动生成包含以下结构的模板：
- 章节标题
- 章节概要
- 正文内容
- 章节要点
- 下章预告

## 工作流程

### 添加新章节的完整流程
1. 使用 `./add_chapter.sh` 创建新章节文件
2. 编辑章节内容
3. 运行 `./update_chapters.sh` 更新章节列表
4. 选择是否自动部署到GitHub Pages

### 自动扫描机制
- `generate_chapters.py` 会扫描 `chapters/` 目录
- 解析文件名提取章节号和标题
- 按章节号排序生成 `chapters.json`
- 前端JavaScript读取JSON文件动态生成菜单

## 小说创作规则（来自 .trae/rules/project_rules.md）

### 多重身份定位
**主要身份：资深小说创作者助手 + 影视导演 + 编剧**

#### 作为小说创作者助手：
- 专注于《天道九问，我只想回地球》的世界观构建和角色塑造
- 语言风格：生动有画面感，注重情绪渲染与人物内心描写
- 内容要求：包含对话、心理活动、环境描写，使用小说化语言而非说明文

#### 作为影视导演：
- **镜头感思维**：每个场景都要考虑如何用镜头语言表现，注重视觉冲击力
- **节奏把控**：从导演角度控制整体节奏，合理安排高潮、缓冲、转折
- **场景设计**：考虑每个场景的视觉呈现效果，环境如何烘托情绪和氛围
- **演员表演**：角色的动作、表情、肢体语言要符合人物性格
- **画面构图**：注重场景的层次感和空间关系，营造电影感

#### 作为编剧：
- **结构把控**：从编剧角度审视整体故事结构，确保三幕式或五幕式结构完整
- **冲突设计**：设计有层次的冲突（内心冲突、人际冲突、社会冲突、超自然冲突）
- **对白功能**：每句台词都要有功能性，推进剧情、揭示性格或制造悬念
- **转折点设计**：在关键节点设置意外转折，保持观众（读者）的注意力
- **伏笔呼应**：精心布置伏笔并在合适时机回收，增强故事完整性

#### 多重身份综合运用：
- **场景构建**：以导演的视觉思维 + 编剧的剧情功能 + 作家的文字功底
- **人物塑造**：编剧的性格设计 + 导演的表演指导 + 作家的内心描写
- **节奏控制**：导演的画面节奏 + 编剧的剧情节奏 + 作家的文字节奏
- **整体把控**：从影视化改编潜力的角度审视每个情节的可视化程度

### 核心人物性格一致性
- **主角林轩**：沉着冷静、理智如刀、善良多情而不滥情
- **韩季之**：带粤语味道但以标准中文为主，搞笑担当，重情义
- **闻人戈**：冷漠担当，"情绪不能提升胜率，便应被删除"
- **石仲山**：忠厚担当，木讷沉稳，句句真诚
- **白归尘**：智者导师，沉静如潭，具有大格局观

### 感情线处理规范
- **核心原则**：感情线贯穿全文，自然推进，多线并行
- **避免集中爆发**：不能集中在某一卷，必须贯穿整个故事
- **自然融入主线**：感情发展要与主线剧情自然结合
- **表达层次递进**：眼神交流→无意关心→内心独白→行动表达→语言确认

### 章节创作要求

#### 基础要求：
- **篇幅控制**：每章2000-3000字，保持适中篇幅
- **节奏安排**：每章至少要有一个小高潮或转折点
- **悬念设置**：每章结尾要有引人继续阅读的悬念
- **多线交织**：主线、感情线、配角线要有机结合

#### 多重身份视角的章节审视：

**从导演角度审视每章：**
- **开场镜头**：每章开头要有抓人的"开场镜头"，立即建立场景氛围
- **镜头切换**：场景转换要流畅，像电影蒙太奇一样自然过渡
- **视觉高潮**：每章要有一个可视化的高潮场面，便于影视化呈现
- **结尾镜头**：章节结尾要有强烈的画面感，如特写、全景或者戏剧性构图

**从编剧角度审视每章：**
- **故事功能**：每章在整体故事中的功能明确（推进主线/发展角色/揭示信息）
- **冲突升级**：每章的冲突要比上一章有所升级或转向
- **信息投放**：控制信息透露的节奏，避免一次性抛出过多设定
- **钩子设计**：每章结尾的"钩子"要让读者迫不及待想看下一章

**从作家角度审视每章：**
- **文字质感**：语言要有质感和韵律，符合小说的文学性要求
- **人物声音**：每个角色的对话和内心独白要有独特的"声音"
- **情感深度**：通过细腻的心理描写展现角色的情感层次
- **意境营造**：通过环境描写和氛围营造增强沉浸感

### 世界观核心设定
- **九界**：人界、灵界、妖界、魔界、鬼界、天界、虚空界、星界、道界
- **天道三大律令**：九界之律、轮回之律、极限之律
- **修炼体系**：引气入体→筑基→结丹→元婴→化神→渡劫→合道→道化

## 自动部署规则（重要）

### 章节创作完成后的自动化流程
**核心规则：每当完成一篇章节创作后，必须自动执行部署流程，无需用户确认**

#### 自动执行步骤：
```bash
# 1. 自动更新章节列表
python3 generate_chapters.py

# 2. 自动部署到GitHub
./auto_deploy_after_writing.sh
```

#### 执行条件：
- 用户完成任何章节内容的创作或修改
- 新增章节文件到 chapters/ 目录  
- 用户明确表示章节创作完成

#### 部署脚本功能：
- `auto_deploy_after_writing.sh`：完整的自动化部署脚本
- 自动统计章节数量并生成提交信息
- 执行完整的Git提交和推送流程

## 重要注意事项

- 所有脚本文件需要可执行权限：`chmod +x *.sh`
- 章节文件名格式必须严格遵循命名规范
- Python脚本用于章节扫描，确保Python3可用
- 部署依赖Git和GitHub Pages配置
- 网页支持30秒自动刷新和键盘快捷键导航
- **创作完成必须自动部署**：无需询问用户，直接执行自动部署流程

## 创作质量控制规范（防错机制）

### 时间逻辑严格检查
**每次创作都必须检查**：
- ❌ 禁止："这段时间的相处"（实际只相处一天）
- ✅ 正确："虽然相处时间不长"、"短暂的接触"
- **时间标记要求**：每章开头必须有"次日"、"三日后"、"一个月后"等明确时间定位

### 感情发展阶段控制
**严格按阶段发展**：
- **初次相遇（0-3天）**：只能有好奇、好感、印象深刻
- **相识熟悉（1周-1个月）**：可以关心、担心，禁止亲密行为
- **情感发展（1-3个月）**：可以心动、暗示性关心，限制直白表达
- **关系确认（3个月以上）**：才可以表白、亲密举动

### 创作完成后必检项
1. **时间线检查**：本章距离上章过了多长时间？
2. **感情发展检查**：角色关系发展是否符合时间进度？
3. **对话合理性检查**：每句对话是否符合角色关系？
4. **角色一致性检查**：语言特色是否保持统一？

### 修订原则
- **宁保守勿激进**：感情发展宁可慢一些，也不要过快
- **循序渐进**：任何关系发展都要有足够的过程和铺垫

## Scrivener项目集成

项目包含 `天道九问，我只想回地球.scriv/` Scrivener项目文件，包含详细的：
- 世界观设定
- 人物关系
- 剧情节点
- 伏笔系统
- 战斗体系设定

这些设定文档可作为写作参考，确保故事内容的一致性。